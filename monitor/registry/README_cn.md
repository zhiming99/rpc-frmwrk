### 简介
* 注册表(registry)是`rpc-frmwrk`的监视器功能的核心模块之一，用来存贮运行态监视数据和配置信息，以及访问控制(access control)信息。注册表除了一般的文件的操作，还可以通过`ReadValue`和`WriteValue`设置一个不超过95字节的`值`，而不用读取文件内容，这个`值`和`路径名`可以看作是一个键值对。由于不同的路径名可以对应同一个`值`，因此注册表比一维的键值表有更大的灵活性。注册表可以看作是二维的树形键值表。注册表支持通过CRegistryFs的API进行访问，也可以安装成文件系统进行访问。  
* 注册表的目录是以B+树的方式存贮的。文件分配表类似`ext2`的组织形式。注册表为尽可能的保持内容的完整性，采用了cache机制，所有的写和更新操作都会暂存在cache中，等cache的生命周期到时，再提交到存贮设备。提交时，cache会确保当前没有正在进行的更新操作。这个措施有效的降低了注册表数据毁坏的概率。不过还是要强调用户最好是`优雅的`关闭使用注册表的程序。`kill -9`这样的停止方式还是有机会使注册表数据遭到破坏。
* 以下是注册表的一些特性和技术指标。

| 名称 | 描述 | 
| -------- | --------- | 
|注册表最大容量|128GB|
|最大文件长度|8460800字节|
|单个目录最大文件数量|75576个|
|基本块大小|可选,缺省512字节|
|超级块大小|512字节|
|块组分配表大小|512字节|
|块组(Block Group)大小|32MB(64K*512)|
|访问控制|ugo+rwx|
|文件名长度|95字节|
|文件值大小|95字节|
|缓存大小|32M字节|
|缓存生命周期|3分钟|


### regfsmnt使用方法
`regfsmnt`是registry文件系统安装工具，可以进行格式化，和安装文件系统(mount)等操作。

#### 命令格式
`regfsmnt [ -cdiush ] <注册表文件路径> [<文件系统安装路径>]`

#### 命令行选项
* <注册表文件路径>是强制参数，必须指定。<文件系统安装路径>在有格式化选项`-i`时被忽略，其他选项时，必须指定。
* -c 使用kernel提供的访问控制，取代registry自己提供的访问控制。
* -d 以后台进程的形式运行。
* -i 格式化由<注册表文件路径>指定的文件。
* -u 在控制台打印文件系统的调试信息，此时不能有`-d`选项。
* -s 开启缓存模式。
* -h 打印帮助信息

#### 例子
* 格式化注册表   
  `regfsmnt -i abc.reg`
* 把注册表安装到指定目录   
  `regfsmnt abc.reg ./mountpont`

### regfschk使用方法
`regfschk`是registry文件的扫描检查工具，用于扫描和报告registry文件的健康状况和损坏信息，并进行简单的修复。

#### 命令格式
`regfschk [ -crshv ] <注册表文件路径>`

#### 命令行选项
* <注册表文件路径>是强制参数，必须指定。
* -c 在发现孤悬的基本块(不属于任何目录或文件的块)时进行回收。
* -r 在新的后缀为`.restore`的注册表文件中重建当前的注册表，并丢弃以损坏的文件和目录。
* -s 安静模式，不打印进度信息。
* -v 打印更多的运行信息。
* -h 打印帮助信息

#### 例子
* 检查一个注册表文件   
  `regfschk abc.reg`
* 检查并重建一个注册表
  `regfschk -r damaged.reg`


#### 命令手册
```
regfsmnt(1), regfschk(1)
```
